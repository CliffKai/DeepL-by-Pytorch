Mem OS

## 1. Memory Storage
MemoryOS 将记忆划分为三个逻辑层级，以平衡信息的实时性、主题深度和长期一致性：
- 短期记忆 (STM)：存储实时对话数据。每一页（Page）包含查询、响应和时间戳。为了保证连贯性，它使用对话链 (Dialogue Chain) 机制，由 LLM 评估新内容与前文的语义关联性，确保上下文跟踪的一致性。
- 中期记忆 (MTM)：采用分段分页 (Segmented Paging) 架构。具有相同主题的对话页被归组为“段（Segment）”。通过语义和关键词相似度（$\mathcal{F}_{score}$）来确定页面是否属于某个特定主题段。
- 长期个人记忆 (LPM)：存储持久化的用户和智能体人格特征。
  - 用户侧：包含静态配置（姓名、性别等）、动态事实知识库（User KB）和演进的兴趣偏好（User Traits）。
  - 智能体侧：包含角色设定（Agent Profile）和在交互中发展的动态属性（Agent Traits）。

## 2. Memory Updating
系统通过特定的策略在不同层级间迁移和清理数据：
- STM 到 MTM：遵循先进先出 (FIFO) 原则。当 STM 队列达到最大容量（如 7 页）时，最旧的对话页将被迁移到 MTM 中相应的主题段。
- MTM 到 LPM：基于热度评分 (Heat Score) 机制。
  - 热度计算：综合考虑访问频率 ($N_{visit}$)、交互深度 ($L_{interaction}$) 和基于指数衰减的时间近时性 ($R_{recency}$)。
  - 迁移与淘汰：热度超过阈值（如 5）的段会被提取核心信息更新到 LPM 中。反之，当存储溢出时，热度最低的段会被驱逐。
- LPM 更新：通过 LLM 从高热度对话中自动提取 90 个维度的用户特质，实现人格的自主演进。

## 3. Retrieval & Generation
为了从庞大的记忆库中精准提取信息，MemoryOS 采用了精细的检索流程：
- 两阶段 MTM 检索：首先通过匹配得分筛选出前 $m$ 个候选主题段，然后再从这些段落中检索出语义最相关的 $k$ 个对话页。这种“由粗到细”的方法模拟了人类的记忆回溯。
- 全方位集成：在生成响应时，系统会整合 STM 的实时上下文、MTM 的历史对话细节以及 LPM 的人格背景信息，构建成最终的 Prompt。

## 4. 机制优势总结

- 高效性：实验证明，相比于 MemGPT 或 A-Mem，MemoryOS 在提升性能的同时显著减少了 LLM 的调用次数和 Token 消耗。
- 连贯性：通过分段分页和对话链设计，即便在长时间跨度的对话中也能保持事实一致性。
- 个性化：LPM 模块确保了 AI 智能体能够记住用户的长期目标（如“减肥”）并在后续互动中主动提及。