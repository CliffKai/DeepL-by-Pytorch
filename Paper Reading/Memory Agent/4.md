A-MEM: Agentic Memory for LLM Agents

## Method

A-MEM 记忆系统从卢曼卡片盒（Zettelkasten）方法中汲取灵感，实现了一个动态且自进化的记忆系统，使 LLM 智能体能够在无需预设操作的情况下维持长期记忆。该系统的设计强调原子化笔记、灵活的链接机制以及知识结构的持续演进。

### 3.1 笔记构建

基于卡片盒方法的原子化笔记和灵活组织原则，A-MEM 引入了一种 LLM 驱动的记忆笔记构建方法。当智能体与环境交互时，A-MEM 会构建结构化的记忆笔记，记录显性信息和 LLM 生成的上下文理解。记忆库 $\mathcal{M}=\{m_{1},m_{2},...,m_{N}\}$ 中的每个笔记 $m_{i}$ 表示为：
$$m_{i}=\{c_{i},t_{i},K_{i},G_{i},X_{i},e_{i},L_{i}\}$$
其中 $c_{i}$ 为原始交互内容，$t_{i}$ 是时间戳，$K_{i}$ 是 LLM 生成的关键词，$G_{i}$ 是分类标签，$X_{i}$ 是提供丰富语义理解的上下文描述，$L_{i}$ 维护具有语义关系的链接记忆集合。构建过程涉及使用设计好的模板 $P_{s1}$ 提示 LLM 生成语义组件：
$$K_{i},G_{i},X_{i}\leftarrow LLM(c_{i}||t_{i}||P_{s1})$$
遵循原子性原则，每条笔记捕捉一个单一、自洽的知识单元。为了实现高效检索，A-MEM 通过文本编码器计算嵌入向量 $e_{i}$：
$$e_{i}=f_{\text{enc}}[\text{concat}(c_{i},K_{i},G_{i},X_{i})]$$

### 3.2 链接生成
A-MEM 系统实现了自主链接生成机制，使新笔记能够形成有意义的连接而无需预设规则。当新笔记 $m_{n}$ 加入时，系统首先利用语义嵌入进行相似度检索：
$$s_{n,j}=\frac{e_{n}\cdot e_{j}}{|e_{n}||e_{j}|}$$
系统识别出前 $k$ 个最相关的记忆 $\mathcal{M}_{\text{near}}^{n}$，并提示 LLM 分析潜在连接：
$$L_{i}\leftarrow LLM(m_{n}||\mathcal{M}_{\text{near}}^{n}||P_{s2})$$
这种 LLM 驱动的分析允许对因果关系和概念连接进行细致理解，而这些可能在单纯的嵌入相似度中并不明显。

### 3.3 记忆进化
创建链接后，A-MEM 会根据新旧记忆的关系演化检索到的记忆内容。对于 $\mathcal{M}_{\text{near}}^{n}$ 中的每个记忆 $m_{j}$，系统决定是否更新其上下文、关键词和标签：
$$m_{j}^{*}\leftarrow LLM(m_{n}||\mathcal{M}_{\text{near}}^{n}\backslash m_{j}||m_{j}||P_{s3})$$
演化后的 $m_{j}^{*}$ 会替换原记忆，这种方式模拟了人类的学习过程，通过持续交互发现更高阶的模式和概念。

### 3.4 检索相关记忆
在每次交互中，A-MEM 执行上下文感知的检索。给定查询 $q$，计算其嵌入 $e_{q}$ 并通过余弦相似度计算得分：
$$s_{q,i}=\frac{e_{q}\cdot e_{i}}{|e_{q}||e_{i}|}$$
检索到的前 $k$ 个记忆 $\mathcal{M}_{\text{retrieved}}$ 被用于构建上下文提示词，通过连接相关的过去经验来增强智能体的推理过程。